drop table IF EXISTS USERS;
drop table IF EXISTS ATTACHMENT;
drop table IF EXISTS POSTS;
drop table IF EXISTS FRIENDSHIPS;
drop table IF EXISTS MESSAGES;

CREATE TABLE IF NOT EXISTS USERS (
	LOGIN CHARACTER VARYING PRIMARY KEY NOT NULL,
	HASH CHARACTER VARYING NOT NULL,
	EMAIL CHARACTER VARYING NOT NULL,
	USER_NAME CHARACTER VARYING NOT NULL,
	CONSTRAINT USERS_FK_1 FOREIGN KEY (USER_NAME) REFERENCES MESSAGES (SENDER) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT USERS_FK_2 FOREIGN KEY (USER_NAME) REFERENCES MESSAGES (RECIPIENT) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT USERS_FK_3 FOREIGN KEY (USER_NAME) REFERENCES POSTS (AUTHOR) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT USERS_FK_4 FOREIGN KEY (USER_NAME) REFERENCES FRIENDSHIPS (FIRST_USER) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT USERS_FK_5 FOREIGN KEY (USER_NAME) REFERENCES FRIENDSHIPS (SECOND_USER) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS POSTS (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	TITLE CHARACTER VARYING(50) NOT NULL,
	DESCRIPTION CHARACTER VARYING(3000) NOT NULL,
	AUTHOR CHARACTER VARYING(20) NOT NULL,
	CREATE_DATE TIMESTAMP WITHOUT TIME ZONE NOT NULL,
	CONSTRAINT POSTS_FK_1 FOREIGN KEY (ID) REFERENCES ATTACHMENT (POST_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS FRIENDSHIPS (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	FIRST_USER CHARACTER VARYING NOT NULL,
	SECOND_USER CHARACTER VARYING NOT NULL
);

CREATE TABLE IF NOT EXISTS MESSAGES (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	SENDER CHARACTER VARYING NOT NULL,
	RECIPIENT CHARACTER VARYING NOT NULL,
	CONTENT CHARACTER VARYING(3000) NOT NULL,
	DATE TIMESTAMP WITHOUT TIME ZONE
);

CREATE TABLE IF NOT EXISTS ATTACHMENT(
	ID CHARACTER VARYING GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	NAME CHARACTER VARYING,
	TYPE CHARACTER VARYING,
	POST_ID BIGINT NOT NULL,
	DATA BYTEA
);